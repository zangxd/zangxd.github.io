<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>AngularJs 核心原理简析一 · zangxd</title><meta name="description" content="AngularJs 核心原理简析一 - zangxd"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/nirvana.css"><link rel="search" type="application/opensearchdescription+xml" href="https://zangxd.com/atom.xml" title="zangxd"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">Archive</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">About</a></li><li class="nav-list-item"><a href="https://github.com/zangxd" target="_blank" class="nav-list-link">GitHub</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">AngularJs 核心原理简析一</h1><div class="post-info">2016年9月2日</div><div class="post-content"><h2 id="核心原理解析"><a href="#核心原理解析" class="headerlink" title="核心原理解析"></a>核心原理解析</h2><h3 id="1-Angular的启动过程"><a href="#1-Angular的启动过程" class="headerlink" title="1.Angular的启动过程"></a>1.Angular的启动过程</h3><p>  angularJS的源代码整体上来说是一个自执行函数，在angularJS加载完成后，就会自动执行了。</p>
<p>  源码分析：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">// First: 首先定义一个全局的angular空对象。</div><div class="line">angular = window.angular || (window.angular = &#123;&#125;)</div><div class="line">  ...</div><div class="line">  ...</div><div class="line">// Second: 判断是不是已经加载过了angular</div><div class="line">if (window.angular.bootstrap) &#123;</div><div class="line">  //AngularJS is already loaded, so we can return here...</div><div class="line">  if (window.console) &#123;</div><div class="line">    console.log(&apos;WARNING: Tried to load angular more than once.&apos;);</div><div class="line">  &#125;</div><div class="line">  return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// Three:绑定jquery</div><div class="line">//try to bind to jquery now so that one can write jqLite(document).ready()</div><div class="line">//but we will rebind on bootstrap again.</div><div class="line">bindJQuery();</div><div class="line"></div><div class="line">// Four: 扩展angular对象的方法和属性</div><div class="line">publishExternalAPI(angular);</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>  其中angular中比较重要的是injector和module。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var injector = angular.injector();</div></pre></td></tr></table></figure>
<blockquote>
<p>injector:得到一个注入器实例对象，它总共有5个方法：annotate，get，has，instantiate，invoke。annotate是用来分析函数的签名的，在angular进行依赖注入的时候，你的函数的参数，你不需要new出来这个参数的对象，你只要告诉它你的函数需要什么东西，angular需要使用这个annotate来分析这些函数的参数。</p>
</blockquote>
<p>  <strong>angular启动总共有三种方法：</strong></p>
<p>  第一种：默认方式，在页面的元素节点上添加ng-app。angular会自动启动。</p>
<p>  第二种：不在页面上添加任何的ng-app，类似jquery的ready方法等待页面加载完成后我们手动启动：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">angular.element(document).ready(function()&#123;</div><div class="line"></div><div class="line">　　angular.bootstrap(document, [&quot;myModule&quot;]);    //myModule是你创建的模块的名字</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>  第三种：在页面上，添加两个ng-app，但是必须在并行的两个元素上添加。angular只会自动启动第一个ng-app，第二个ng-app需要你按照第二种方法，手动启动。<strong>此方式不推荐使用</strong></p>
<p>  <strong>angular是怎么绑定jquery的，如果发现导入了jquery就使用导入的jquery，否则使用自身的</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">function bindJQuery() &#123;</div><div class="line">  var originalCleanData;</div><div class="line"></div><div class="line">  if (bindJQueryFired) &#123;</div><div class="line">    return;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  // bind to jQuery if present;</div><div class="line">  var jqName = jq();</div><div class="line">  jQuery = isUndefined(jqName) ? window.jQuery :   // use jQuery (if present)</div><div class="line">           !jqName             ? undefined     :   // use jqLite</div><div class="line">                                 window[jqName];   // use jQuery specified by `ngJq`</div><div class="line"></div><div class="line">  // Use jQuery if it exists with proper functionality, otherwise default to us.</div><div class="line">  // Angular 1.2+ requires jQuery 1.7+ for on()/off() support.</div><div class="line">  // Angular 1.3+ technically requires at least jQuery 2.1+ but it may work with older</div><div class="line">  // versions. It will not work for sure with jQuery &lt;1.7, though.</div><div class="line">  if (jQuery &amp;&amp; jQuery.fn.on) &#123;</div><div class="line">    jqLite = jQuery;</div><div class="line">    extend(jQuery.fn, &#123;</div><div class="line">      scope: JQLitePrototype.scope,</div><div class="line">      isolateScope: JQLitePrototype.isolateScope,</div><div class="line">      controller: JQLitePrototype.controller,</div><div class="line">      injector: JQLitePrototype.injector,</div><div class="line">      inheritedData: JQLitePrototype.inheritedData</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    // All nodes removed from the DOM via various jQuery APIs like .remove()</div><div class="line">    // are passed through jQuery.cleanData. Monkey-patch this method to fire</div><div class="line">    // the $destroy event on all removed nodes.</div><div class="line">    originalCleanData = jQuery.cleanData;</div><div class="line">    jQuery.cleanData = function(elems) &#123;</div><div class="line">      var events;</div><div class="line">      for (var i = 0, elem; (elem = elems[i]) != null; i++) &#123;</div><div class="line">        events = jQuery._data(elem, &quot;events&quot;);</div><div class="line">        if (events &amp;&amp; events.$destroy) &#123;</div><div class="line">          jQuery(elem).triggerHandler(&apos;$destroy&apos;);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      originalCleanData(elems);</div><div class="line">    &#125;;</div><div class="line">  &#125; else &#123;</div><div class="line">    jqLite = JQLite;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  angular.element = jqLite;</div><div class="line"></div><div class="line">  // Prevent double-proxying.</div><div class="line">  bindJQueryFired = true;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <strong>通过publishExternalAPI方法发布ng的API到全局对象angular，最重要的是setupModuleLoader方法：给angular构建模块加载器</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">function setupModuleLoader(window) &#123;</div><div class="line">　　　function ensure(obj, name, factory) &#123;</div><div class="line">        return obj[name] || (obj[name] = factory());</div><div class="line">    &#125;</div><div class="line">    var angular = ensure(window, &apos;angular&apos;, Object);    //设置window.angular等于一个空对象</div><div class="line">　　　　 return ensure(angular, &apos;module&apos;, function() &#123;         //把angular.module设置成这个module函数，并返回这个函数。   </div><div class="line">        var modules = &#123;&#125;;   //当我们使用angular.module创建一个模块时，都会缓存在变量modules中。</div><div class="line">        return function module(name, requires, configFn) &#123;   //当我们通过var demo1 = angular.module(&apos;demoApp&apos;, []);创建一个模块时，它返回的是moduleInstance。而这个moduleInstance对象有factory()，controller()，directive()，config()，run()等方法可以调用。</div><div class="line">　　　　　　　　  if (requires &amp;&amp; modules.hasOwnProperty(name)) &#123;   //如果有同名的模块已经创建过，就把以前的那个模块删除。这里使用的是一个闭包，因为每次调用angular.module进行模块的创建时，访问的modules对象是在外层的匿名函数中定义的，本来一个函数执行结束后，就会销毁里面的变量，虽然这里匿名函数已经执行结束了，但是由于内部函数module引用了此变量modules，所以即便外层的匿名函数执行结束了，它里面定义的modules变量也不会销毁。通过闭包，我们可以定义一个私有的变量modules，只能通过规定的方法angular.module进行访问，外部无法操作这个私有的变量modules。</div><div class="line">                modules[name] = null;</div><div class="line">            &#125;</div><div class="line">            return ensure(modules, name, function() &#123;      //modules[demoApp] = moduleInstance，并返回这个moduleInstance。</div><div class="line">                var invokeQueue = [];</div><div class="line">                var runBlocks = [];</div><div class="line">                var config = invokeLater(&apos;$injector&apos;, &apos;invoke&apos;);</div><div class="line">                var moduleInstance = &#123;    //模块实例的方法</div><div class="line">                    requires: requires,</div><div class="line">                    provider: invokeLater(&apos;$provide&apos;, &apos;provider&apos;),</div><div class="line">                    factory: invokeLater(&apos;$provide&apos;, &apos;factory&apos;),</div><div class="line">                    service: invokeLater(&apos;$provide&apos;, &apos;service&apos;),</div><div class="line">                    value: invokeLater(&apos;$provide&apos;, &apos;value&apos;),</div><div class="line">                    constant: invokeLater(&apos;$provide&apos;, &apos;constant&apos;, &apos;unshift&apos;),</div><div class="line">                    animation: invokeLater(&apos;$animateProvider&apos;, &apos;register&apos;),</div><div class="line">                    filter: invokeLater(&apos;$filterProvider&apos;, &apos;register&apos;),       //当我们通过一个模块实例创建一个过滤器时，调用的是invokeLater方法返回的匿名函数function()&#123;    invokeQueue[&apos;push&apos;]([$filterProvider, register, arguments]);   return moduleInstance;    &#125;</div><div class="line">                    controller: invokeLater(&apos;$controllerProvider&apos;, &apos;register&apos;),                  </div><div class="line">                    directive: invokeLater(&apos;$compileProvider&apos;, &apos;directive&apos;),               </div><div class="line">                    config: config,               </div><div class="line">                    run: function(block) &#123;</div><div class="line">                        runBlocks.push(block);</div><div class="line">                        return this;</div><div class="line">                    &#125;</div><div class="line">                &#125;;</div><div class="line">　　　　　　　　　　　　</div><div class="line">　　　　　　　　　　　 if(configFn)&#123;    //当调用angular.module方法传入了三个参数时，就会执行config方法，上面在定义ng模块时，就会传入第三个参数。</div><div class="line">　　　　　　　　　　　　　　config(configFn);    //config方法其实就是invokeLater方法执行后的返回值。这里执行之后，也是对数组invokeQueue进行push操作。当ng模块创建时，invokeQueue = [  [ $injector, invoke, [[$provide, function ngModule()&#123;&#125;]] ]    ]。</div><div class="line">　　　　　　　　　　　　&#125;</div><div class="line"></div><div class="line">                return  moduleInstance;</div><div class="line">                function invokeLater(provider, method, insertMethod) &#123;</div><div class="line">                    return function() &#123;</div><div class="line">                        invokeQueue[insertMethod || &apos;push&apos;]([provider, method, arguments]);</div><div class="line">                        return moduleInstance;</div><div class="line">                    &#125;;</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  当我们定义了一个var myModule = angular.module(“myModule”, [] );模块时，通过模块myModule调用controller，directive，service方法分别创建控制器，指令，服务的这些方法都是在上面的moduleInstance对象中定义的。这里的myModule就是moduleInstance对象的一个实例。</p>
<p>  publishExternalAPI方法构建好模块加载器之后，会先把自己的内核模块加载起来，比如：把ng模块，ngLocale模块注册进来，同时，会把一些内核的指令注册进来。</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">function publishExternalAPI(angular)&#123;</div><div class="line">    extend(angular, &#123;              //绑定方法到angular对象上</div><div class="line">          &apos;bootstrap&apos;: bootstrap,</div><div class="line"></div><div class="line">　　　　　　　　&apos;extend&apos;: extend,</div><div class="line"></div><div class="line">　　　　　　　　&apos;element&apos;: jqLite,</div><div class="line"></div><div class="line">　　　　　　　　&apos;injector&apos;: createInjector,</div><div class="line">　　　　　　　  ......</div><div class="line">    &#125;);</div><div class="line">    angularModule = setupModuleLoader(window);      // 此方法会把angular对象绑定到window上，然后把一个函数绑定到angular的module属性上，最后返回这个函数，这个函数是一个模块加载器,主要作用是创建和获取模块。这里的angularModule函数就是angular.module函数。</div><div class="line">    try &#123;</div><div class="line">        angularModule(&apos;ngLocale&apos;);</div><div class="line">    &#125; catch (e) &#123;</div><div class="line">        angularModule(&apos;ngLocale&apos;, []).provider(&apos;$locale&apos;, $LocaleProvider);    //创建一个名为ngLocale的模块，并在这个模块上定义一个名为$locale的$LocaleProvider服务提供者。这里的provider方法,是把方法中的参数都存到invokeQueue数组中，以便在后面调用，从setupModuleLoader方法中很容易知道。</div><div class="line">    &#125;</div><div class="line">    angularModule(&apos;ng&apos;, [&apos;ngLocale&apos;], [&apos;$provide&apos;,      //创建一个名为ng的模块，这个模块依赖于ngLocale模块。</div><div class="line">        function ngModule($provide) &#123;        </div><div class="line">            $provide.provider(&#123;</div><div class="line">                $$sanitizeUri: $$SanitizeUriProvider</div><div class="line">            &#125;);</div><div class="line">            $provide.provider(&apos;$compile&apos;, $CompileProvider).     //ng模块中，定义一个名为$compile的$CompileProvider服务提供者</div><div class="line">                directive(&#123;  </div><div class="line">                    a: htmlAnchorDirective,</div><div class="line">                    input: inputDirective,</div><div class="line">                    textarea: inputDirective,</div><div class="line">                    form: formDirective,</div><div class="line">                    option: optionDirective,</div><div class="line">                    ngBind: ngBindDirective,                 </div><div class="line">                    ngClass: ngClassDirective,</div><div class="line">                    ngController: ngControllerDirective,</div><div class="line">                    ngForm: ngFormDirective,</div><div class="line">                    ngHide: ngHideDirective,</div><div class="line">                    ngIf: ngIfDirective,</div><div class="line">                    ngInit: ngInitDirective,</div><div class="line">                    ngRepeat: ngRepeatDirective,</div><div class="line">                    ngShow: ngShowDirective,</div><div class="line">                    ngOptions: ngOptionsDirective,</div><div class="line">                    ngTransclude: ngTranscludeDirective,</div><div class="line">                    ngModel: ngModelDirective,</div><div class="line">                    ngList: ngListDirective,</div><div class="line">                    ngChange: ngChangeDirective,</div><div class="line">                    required: requiredDirective,</div><div class="line">                    ngRequired: requiredDirective,</div><div class="line">                    ngValue: ngValueDirective</div><div class="line">                &#125;);</div><div class="line">            $provide.provider(&#123;          //在ng模块中，定义一系列的服务提供者</div><div class="line">                $animate: $AnimateProvider,                </div><div class="line">                $controller: $ControllerProvider,</div><div class="line">                $filter: $FilterProvider,</div><div class="line">                $http: $HttpProvider,</div><div class="line">                $location: $LocationProvider,</div><div class="line">                $parse: $ParseProvider,</div><div class="line">                $rootScope: $RootScopeProvider,</div><div class="line">                $window: $WindowProvider</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    ]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <strong>最后，就是angularInit方法：此方法会去判断页面上是否有ng-app，如果有，就调用bootstrap方法进行启动。如果没有，你就需要自己手动去启动了。</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">function angularInit(element, bootstrap) &#123;   </div><div class="line">    var elements = [element],  </div><div class="line">        appElement,</div><div class="line">        module,</div><div class="line">        names = [&apos;ng:app&apos;, &apos;ng-app&apos;, &apos;x-ng-app&apos;, &apos;data-ng-app&apos;],   //angular有4种方式在页面上定义angular应用</div><div class="line">        NG_APP_CLASS_REGEXP = /\sng[:\-]app(:\s*([\w\d_]+);?)?\s/;</div><div class="line">    function append(element) &#123;    </div><div class="line">        element &amp;&amp; elements.push(element);</div><div class="line">    &#125;</div><div class="line">    forEach(names, function(name) &#123;</div><div class="line">        names[name] = true;</div><div class="line">        append(document.getElementById(name));</div><div class="line">        name = name.replace(&apos;:&apos;, &apos;\\:&apos;);</div><div class="line">        if (element.querySelectorAll) &#123;</div><div class="line">            forEach(element.querySelectorAll(&apos;.&apos; + name), append);</div><div class="line">            forEach(element.querySelectorAll(&apos;.&apos; + name + &apos;\\:&apos;), append);</div><div class="line">            forEach(element.querySelectorAll(&apos;[&apos; + name + &apos;]&apos;), append);</div><div class="line">        &#125;</div><div class="line">    &#125;);    //针对4种定义方式，在页面上获取定义为angular应用的元素节点，</div><div class="line">    forEach(elements, function(element) &#123;</div><div class="line">        if (!appElement) &#123;    //appElement只定义一次</div><div class="line">            var className = &apos; &apos; + element.className + &apos; &apos;;</div><div class="line">            var match = NG_APP_CLASS_REGEXP.exec(className);    //使用正则表达式去匹配</div><div class="line">            if (match) &#123;</div><div class="line">                appElement = element;</div><div class="line">                module = (match[2] || &apos;&apos;).replace(/\s+/g, &apos;,&apos;);</div><div class="line">            &#125; else &#123;</div><div class="line">                forEach(element.attributes, function(attr) &#123;</div><div class="line">                    if (!appElement &amp;&amp; names[attr.name]) &#123;</div><div class="line">                        appElement = element;</div><div class="line">                        module = attr.value;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);    //定义angular应用的元素，也就是在页面上写有ng-app（有4种方式定义）的元素定义为appElement。</div><div class="line">    if (appElement) &#123;     </div><div class="line">        bootstrap(appElement, module ? [module] : []); //如果页面上有定义angular应用的元素，就启动。</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>  <strong>调用bootstrap方法，才说明angular真正启动</strong></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">function bootstrap(element, modules) &#123;</div><div class="line">    var doBootstrap = function() &#123;      //定义一个函数</div><div class="line">        element = jqLite(element);</div><div class="line">        if (element.injector()) &#123;    //如果此元素的angular应用已经启动过了，就抛出错误</div><div class="line">            var tag = (element[0] === document) ? &apos;document&apos; : startingTag(element);</div><div class="line">            throw ngMinErr(&apos;btstrpd&apos;, &quot;App Already Bootstrapped with this Element &apos;&#123;0&#125;&apos;&quot;, tag);</div><div class="line">        &#125;</div><div class="line">        modules = modules || [];</div><div class="line">        modules.unshift([&apos;$provide&apos;, function($provide) &#123;</div><div class="line">            $provide.value(&apos;$rootElement&apos;, element);</div><div class="line">        &#125;]);</div><div class="line">        modules.unshift(&apos;ng&apos;);     //这里，我们假设在页面上定义了ng-app的元素，没有添加任何的多余的东西。因此这里的modules=[&quot;ng&quot;,[&quot;$provide&quot;,function($provide)&#123;&#125;]]。</div><div class="line">        var injector = createInjector(modules);   //这个方法非常重要，它把我们angular应用需要初始化的模块数组传进去后，进行加载，并创建一个注册器实例对象，最后返回这个注册器实例对象。</div><div class="line">        injector.invoke([&apos;$rootScope&apos;, &apos;$rootElement&apos;, &apos;$compile&apos;, &apos;$injector&apos;, &apos;$animate&apos;,  //调用注册器实例对象的invoke方法</div><div class="line">            function(scope, element, compile, injector, animate) &#123;</div><div class="line">                scope.$apply(function() &#123;</div><div class="line">                    element.data(&apos;$injector&apos;, injector);</div><div class="line">                    compile(element)(scope);    </div><div class="line">                &#125;);</div><div class="line">            &#125;]</div><div class="line">        );</div><div class="line">        return injector;     </div><div class="line">    &#125;;</div><div class="line">    var NG_DEFER_BOOTSTRAP = /^NG_DEFER_BOOTSTRAP!/;</div><div class="line">    if (window &amp;&amp; !NG_DEFER_BOOTSTRAP.test(window.name)) &#123;   //如果window.name不是以NG_DEFER_BOOTSTRAP!开头的话，就进入if语句，执行上面定义的方法。</div><div class="line">        return doBootstrap();     </div><div class="line">    &#125;</div><div class="line">    window.name = window.name.replace(NG_DEFER_BOOTSTRAP, &apos;&apos;);</div><div class="line">    angular.resumeBootstrap = function(extraModules) &#123;</div><div class="line">        forEach(extraModules, function(module) &#123;</div><div class="line">            modules.push(module);</div><div class="line">        &#125;);</div><div class="line">        doBootstrap();</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>上面的代码会创建一个注入器，也就是说angular在启动时，会创建一个注入器。一个angular应用只有一个注入器。当创建好注入器后，它会首先把内核加载起来，通过compile方法</p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2016/09/02/AngularJs核心原理简析二/" class="prev">PREV</a><a href="/2016/08/31/AngularJs基础知识/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2017 <a href="https://zangxd.com">zangxd</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-nirvana</a>.</p></div></footer></div><script async="" src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>